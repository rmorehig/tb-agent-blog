DESCRIPTION >
    API endpoint to return the most visited locations with visit counts

NODE top_locations_data
SQL >
    %
    SELECT 
        country,
        city,
        count(*) as visit_count
    FROM blog_visits
    WHERE 
        {% if defined(start_date) %}
        timestamp >= {{DateTime(start_date)}}
        {% else %}
        timestamp >= now() - interval 30 day
        {% end %}
        {% if defined(end_date) %}
        AND timestamp <= {{DateTime(end_date)}}
        {% else %}
        AND timestamp <= now()
        {% end %}
        {% if defined(country_filter) %}
        AND country = {{String(country_filter)}}
        {% end %}
    GROUP BY country, city
    ORDER BY visit_count DESC
    LIMIT {{Int(limit, 50)}}

TYPE endpoint